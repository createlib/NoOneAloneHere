<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebaseæ¥ç¶šè¨ºæ–­ãƒ„ãƒ¼ãƒ«</title>
    <style>
        body { font-family: sans-serif; padding: 2rem; max-width: 800px; margin: 0 auto; background: #f0f2f5; }
        .card { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { margin-top: 0; color: #1a73e8; }
        .step { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #eee; }
        .status { font-weight: bold; margin-left: 10px; }
        .success { color: green; }
        .error { color: red; }
        .btn { background: #1a73e8; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #1557b0; }
        pre { background: #333; color: #fff; padding: 1rem; border-radius: 4px; overflow-x: auto; font-family: monospace; }
        code { color: #e83e8c; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Firebase æ¥ç¶šè¨ºæ–­ (ä¿®æ­£ç‰ˆ)</h1>
        <p>éšå±¤æ§‹é€ ã‚’ä¿®æ­£ã—ã¦ã€æ›¸ãè¾¼ã¿ãƒ†ã‚¹ãƒˆã‚’è¡Œã„ã¾ã™ã€‚</p>

        <!-- Step 1 -->
        <div class="step">
            <h3>1. è¨­å®šç¢ºèª</h3>
            <p>ã‚³ãƒ¼ãƒ‰å†…ã® <code>firebaseConfig</code> ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>
        </div>

        <!-- Step 2 -->
        <div class="step">
            <h3>2. æ¥ç¶šãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h3>
            <button class="btn" onclick="runTest()">ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
        </div>

        <!-- Log Area -->
        <div>
            <h3>å®Ÿè¡Œãƒ­ã‚°</h3>
            <div id="log-container">
                <pre id="logs">ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™...</pre>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
        // ã€é‡è¦ã€‘ã“ã“ã«ã‚ãªãŸã®Firebase Configã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼
        // â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
        const firebaseConfig = {
  apiKey: "AIzaSyBVDZJhL9sMzVknD5tNomLWF-0z0jPU3i0",
  authDomain: "brainbridge-4b8ac.firebaseapp.com",
  projectId: "brainbridge-4b8ac",
  storageBucket: "brainbridge-4b8ac.firebasestorage.app",
  messagingSenderId: "803209683213",
  appId: "1:803209683213:web:b62d13784fa2bbbb9f5044"
        };
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        // ãƒ­ã‚°è¡¨ç¤ºç”¨é–¢æ•°
        const logArea = document.getElementById('logs');
        function log(msg, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : (type === 'success' ? '#4caf50' : 'white');
            logArea.innerHTML += `<div style="color:${color}">[${timestamp}] ${msg}</div>`;
            console.log(msg);
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–¢æ•°ã‚’windowã«ç™»éŒ²
        window.runTest = async () => {
            logArea.innerHTML = ''; // ã‚¯ãƒªã‚¢
            log("--- ãƒ†ã‚¹ãƒˆé–‹å§‹ ---");

            // 1. åˆæœŸåŒ–ãƒã‚§ãƒƒã‚¯
            if (firebaseConfig.apiKey === "YOUR_API_KEY") {
                log("âŒ ã‚¨ãƒ©ãƒ¼: firebaseConfigãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†ã—ã¦APIã‚­ãƒ¼ãªã©ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚", 'error');
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const db = getFirestore(app);
                log("âœ… Firebase SDKã®åˆæœŸåŒ–: æˆåŠŸ", 'success');

                // 2. èªè¨¼ãƒã‚§ãƒƒã‚¯
                log("èªè¨¼ï¼ˆåŒ¿åãƒ­ã‚°ã‚¤ãƒ³ï¼‰ã‚’è©¦è¡Œä¸­...");
                const userCredential = await signInAnonymously(auth);
                const user = userCredential.user;
                log(`âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: UID = ${user.uid}`, 'success');

                // 3. Firestoreæ›¸ãè¾¼ã¿ãƒã‚§ãƒƒã‚¯
                const appId = 'default-app-id';
                // ã€ä¿®æ­£ã€‘æœ«å°¾ã« /data ã‚’è¿½åŠ ã—ã¦å¶æ•°éšå±¤ï¼ˆ6éšå±¤ï¼‰ã«ã™ã‚‹
                const testPath = `artifacts/${appId}/users/${user.uid}/profile/data`;
                
                log(`Firestoreã¸ã®æ›¸ãè¾¼ã¿ã‚’è©¦è¡Œä¸­...\nãƒ‘ã‚¹: ${testPath}`);
                
                const testData = {
                    userId: user.uid,
                    message: "æ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸï¼éšå±¤ä¿®æ­£æ¸ˆã¿",
                    updatedAt: new Date().toISOString()
                };

                // ã€ä¿®æ­£ã€‘docé–¢æ•°ã®å¼•æ•°ã« 'data' ã‚’è¿½åŠ 
                await setDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'data'), testData);
                
                log("âœ… Firestoreæ›¸ãè¾¼ã¿: æˆåŠŸï¼", 'success');
                log("ğŸ‘‰ ã“ã‚Œã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã¯ç¢ºç«‹ã•ã‚Œã¾ã—ãŸã€‚", 'success');
                log("ğŸ‘‰ æœ¬ç•ªã‚³ãƒ¼ãƒ‰ï¼ˆprofile.htmlç­‰ï¼‰ã‚‚åŒæ§˜ã«ãƒ‘ã‚¹ã®ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚", 'info');

            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ${error.message}`, 'error');
                
                if (error.code === 'permission-denied') {
                    log("ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ãƒ‘ã‚¹ã‚’å¤‰æ›´ã—ãŸãŸã‚ã€Firestoreã®ã€Œãƒ«ãƒ¼ãƒ«ã€ã‚‚ä¿®æ­£ãŒå¿…è¦ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\nç¾åœ¨ã®ãƒ«ãƒ¼ãƒ«ãŒ 'match /users/{userId}/profile/data' ã‚’è¨±å¯ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚", 'info');
                }
            }
        };
    </script>
</body>
</html>
