<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† | NOAH</title>
    <link rel="icon" href="img/icon.png">
    
    <!-- Google Fonts: Noto Serif JP -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { serif: ['Noto Serif JP', 'serif'] },
                    colors: { 
                        brand: { 
                            50: '#f7f5f0',   // bg
                            100: '#e8dfd1',  // border light
                            200: '#dcd4c6',  // border medium
                            300: '#c8b9a6',  // border dark
                            400: '#a09080',  // text muted
                            500: '#8b6a4f',  // accent
                            600: '#725b3f',  // accent hover
                            700: '#5c4a3d',  // text body
                            800: '#4a3b32',  // text heading
                            900: '#3e2723'   // text dark
                        } 
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            font-family: 'Noto Serif JP', serif;
            background-color: #f7f5f0; 
            color: #4a3b32;
        }
        
        .bg-texture {
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
        }

        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary ~ * { animation: slideDown 0.3s ease-in-out; }
        @keyframes slideDown { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } }
        .accordion-arrow { transition: transform 0.3s ease; }
        details[open] .accordion-arrow { transform: rotate(180deg); }
        .tag-checkbox:checked + div { background-color: #8b6a4f; color: #fffdf9; border-color: #8b6a4f; }
        
        /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«ä¸Šæ›¸ã */
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #8b6a4f !important;
            box-shadow: 0 0 0 1px #8b6a4f !important;
        }
    </style>
</head>
<body class="min-h-screen bg-texture pb-24">

    <!-- Header -->
    <header class="bg-[#fffdf9] bg-texture border-b border-brand-200 shadow-sm sticky top-0 z-20">
        <div class="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center relative z-10">
            <h1 class="text-xl font-bold text-brand-900 flex items-center font-serif tracking-widest">
                èˆªæµ·éŒ²ã®ç·¨é›† 
                <span id="admin-label" class="hidden text-[10px] text-[#2a1a17] bg-[#d4af37] px-2 py-1 rounded-sm ml-3 border border-[#b8860b] font-sans tracking-widest">
                    <i class="fa-solid fa-crown mr-1"></i>ç®¡ç†è€…
                </span>
            </h1>
            <div class="flex space-x-4 items-center">
                <button onclick="history.back()" class="text-brand-500 hover:text-brand-800 text-sm font-medium transition-colors tracking-widest">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="saveProfile()" class="bg-[#3e2723] hover:bg-[#2a1a17] text-[#f7f5f0] px-5 py-2 rounded-sm text-sm font-bold shadow-md transition-colors tracking-widest border border-[#3e2723]">
                    è¨˜éŒ²ã™ã‚‹
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-3xl mx-auto mt-8 px-4">
        <!-- å……å®Ÿåº¦ã«é–¢ã™ã‚‹æ¡ˆå†… -->
        <div class="bg-brand-50 border border-brand-200 p-4 rounded-sm mb-8 text-sm text-brand-700 leading-relaxed shadow-sm">
            <p class="font-bold text-brand-900 mb-1 tracking-widest"><i class="fa-solid fa-circle-info mr-2 text-brand-500"></i>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å……å®Ÿåº¦ã«ã¤ã„ã¦</p>
            <p>å„é …ç›®ã‚’è©³ç´°ã«è¨˜è¼‰ã™ã‚‹ã“ã¨ã§ã€Œãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å……å®Ÿåº¦ã€ãŒä¸Šæ˜‡ã—ã¾ã™ã€‚<br>æƒ³ã„ã‚„ç›®æ¨™ï¼ˆ500å­—ä»¥ä¸Šï¼‰ã€è‡ªå·±ç´¹ä»‹ï¼ˆ100å­—ä»¥ä¸Šï¼‰ã€ã‚¹ã‚­ãƒ«ãƒ»è¶£å‘³ï¼ˆå„3ã¤ä»¥ä¸Šï¼‰ãªã©ã‚’æº€ãŸã™ã¨ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ãŒåŠ ç®—ã•ã‚Œã¾ã™ã€‚</p>
        </div>

        <form id="profile-form" class="space-y-8" onsubmit="event.preventDefault();">
            
            <!-- 0. å…¬é–‹è¨­å®šãƒ»è·æ¥­ -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <h2 class="text-lg font-bold text-brand-900 mb-4 pb-2 border-b border-brand-200 font-serif tracking-widest">åŸºæœ¬è¨­å®š</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 relative z-10">
                    <div>
                        <label class="block text-sm font-medium text-brand-700 tracking-widest">å…¬é–‹çŠ¶æ…‹</label>
                        <select name="profilePublic" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                            <option value="true">å…¬é–‹ã™ã‚‹</option>
                            <option value="false">éå…¬é–‹ï¼ˆä¸‹æ›¸ãï¼‰</option>
                        </select>
                        <p class="text-xs text-brand-500 mt-1">â€»ARRIVALä¼šå“¡ã¯è¨­å®šã«é–¢ã‚ã‚‰ãšæ¤œç´¢çµæœã«ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-brand-700 tracking-widest">è·æ¥­ãƒ»è‚©æ›¸</label>
                        <input type="text" name="jobTitle" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                    </div>
                </div>
            </div>

            <!-- 1. åŸºæœ¬æƒ…å ± -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <h2 class="text-lg font-bold text-brand-900 mb-6 pb-2 border-b border-brand-200 font-serif tracking-widest">â‘  åŸºæœ¬æƒ…å ±</h2>
                
                <div class="mb-8 flex flex-col items-center sm:flex-row sm:items-start space-y-4 sm:space-y-0 sm:space-x-6 relative z-10">
                    <div class="relative h-24 w-24 rounded-sm border-4 border-brand-100 bg-[#f7f5f0] flex items-center justify-center overflow-hidden shadow-sm">
                        <img id="edit-icon-preview" src="" class="hidden w-full h-full object-cover">
                        <i id="edit-icon-placeholder" class="fa-solid fa-anchor text-3xl text-brand-300"></i>
                    </div>
                    <div class="flex-1 w-full text-center sm:text-left">
                        <label class="block text-sm font-medium text-brand-700 tracking-widest">è‚–åƒç”»ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ï¼‰</label>
                        <input type="file" id="icon-upload" accept="image/*" class="mt-2 block w-full text-sm text-brand-500 file:mr-4 file:py-2 file:px-4 file:rounded-sm file:border-0 file:text-xs file:font-bold file:bg-brand-50 file:text-brand-800 hover:file:bg-brand-100 file:border file:border-brand-200 file:cursor-pointer">
                        <p class="mt-2 text-xs text-brand-400">æ¨å¥¨: æ­£æ–¹å½¢ã®ç”»åƒ (JPG, PNG)</p>
                        <p id="upload-status" class="text-xs text-red-500 hidden mt-1"></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 gap-6 relative z-10">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-brand-700 tracking-widest">æ°åï¼ˆè¡¨ç¤ºç”¨ï¼‰ <span class="text-red-500">*</span></label>
                            <input type="text" name="name" required class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-brand-700 tracking-widest">ãµã‚ŠãŒãª</label>
                            <input type="text" name="nameKana" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-brand-700 tracking-widest">æ€§åˆ¥</label>
                            <select name="gender" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                                <option value="">æœªé¸æŠ</option>
                                <option value="ç”·æ€§">ç”·æ€§</option>
                                <option value="å¥³æ€§">å¥³æ€§</option>
                                <option value="ãã®ä»–">ãã®ä»–</option>
                                <option value="å›ç­”ã—ãªã„">å›ç­”ã—ãªã„</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-brand-700 tracking-widest">ç”Ÿå¹´æœˆæ—¥</label>
                            <input type="date" name="birthDate" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-brand-700 tracking-widest">å…¬é–‹ç¯„å›²</label>
                            <select name="birthVisibility" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                                <option value="private">éå…¬é–‹</option>
                                <option value="monthDay">æœˆæ—¥ã®ã¿å…¬é–‹</option>
                                <option value="full">å…¨ã¦å…¬é–‹</option>
                            </select>
                        </div>
                    </div>
                    <!-- Bio -->
                    <div>
                        <label class="block text-sm font-medium text-brand-700 mb-1 tracking-widest">è‡ªå·±ç´¹ä»‹ï¼ˆå…¬é–‹ãƒ»369æ–‡å­—ä»¥å†…ï¼‰</label>
                        <textarea name="bio" rows="4" maxlength="369" class="block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-3 border bg-[#fffdf9] leading-relaxed" placeholder="ã¯ã˜ã‚ã¾ã—ã¦ï¼ã€‡ã€‡ã‚’ã—ã¦ã„ã¾ã™ã€‚"></textarea>
                        <p class="text-xs text-brand-500 mt-1 text-right">â€»100æ–‡å­—ä»¥ä¸Šã§å……å®Ÿåº¦UP</p>
                    </div>
                </div>
            </div>

            <!-- 2. é€£çµ¡ãƒ»å¤–éƒ¨ãƒªãƒ³ã‚¯ -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <h2 class="text-lg font-bold text-brand-900 mb-4 pb-2 border-b border-brand-200 font-serif tracking-widest">â‘¡ é€£çµ¡å…ˆãƒ»SNS</h2>
                <div class="space-y-4 relative z-10">
                    <div>
                        <label class="block text-sm font-medium text-brand-700 tracking-widest">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆé€£çµ¡ç”¨ï¼‰</label>
                        <input type="email" name="contactEmail" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-brand-700 tracking-widest">WEBã‚µã‚¤ãƒˆ (URL)</label>
                            <input type="url" name="websiteUrl" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-brand-700 tracking-widest">Instagram (ID/URL)</label>
                            <input type="text" name="snsInstagram" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-brand-700 tracking-widest">X (æ—§Twitter) (ID/URL)</label>
                            <input type="text" name="snsX" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 3. å‡ºèº«åœ° (NEW) -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <h2 class="text-lg font-bold text-brand-900 mb-4 pb-2 border-b border-brand-200 font-serif tracking-widest">â‘¢ å‡ºèº«åœ°</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 relative z-10">
                    <div>
                        <label class="block text-sm font-medium text-brand-700 tracking-widest">éƒ½é“åºœçœŒ</label>
                        <select name="birthPrefecture" id="birth-prefecture-select" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-brand-700 tracking-widest">å¸‚åŒºç”ºæ‘</label>
                        <input type="text" name="birthCity" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                    </div>
                </div>
            </div>

            <!-- 4. ã‚¨ãƒªã‚¢ -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <h2 class="text-lg font-bold text-brand-900 mb-4 pb-2 border-b border-brand-200 font-serif tracking-widest">â‘£ ç¾åœ¨ã®æ´»å‹•ã‚¨ãƒªã‚¢</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 relative z-10">
                    <div>
                        <label class="block text-sm font-medium text-brand-700 tracking-widest">éƒ½é“åºœçœŒ</label>
                        <select name="prefecture" id="prefecture-select" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-brand-700 tracking-widest">å¸‚åŒºç”ºæ‘</label>
                        <input type="text" name="city" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                    </div>
                </div>
            </div>

            <!-- 5. è¶£å‘³ -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <div class="flex justify-between items-end mb-4 border-b border-brand-200 pb-2 relative z-10">
                    <h2 class="text-lg font-bold text-brand-900 font-serif tracking-widest">â‘¤ è¶£å‘³</h2>
                    <span class="text-xs text-brand-500">â€»3ã¤ä»¥ä¸Šé¸æŠã§å……å®Ÿåº¦UP</span>
                </div>
                <div id="hobbies-container" class="space-y-3 relative z-10"></div>
                <div class="mt-4 relative z-10">
                    <label class="block text-sm font-medium text-brand-700 tracking-widest">ãã®ä»–ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</label>
                    <input type="text" name="hobbyOtherText" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-2 border bg-[#fffdf9]">
                </div>
            </div>

            <!-- 6. ç‰¹æŠ€ -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <div class="flex justify-between items-end mb-4 border-b border-brand-200 pb-2 relative z-10">
                    <h2 class="text-lg font-bold text-brand-900 font-serif tracking-widest">â‘¥ ç‰¹æŠ€ãƒ»ã‚¹ã‚­ãƒ«</h2>
                    <span class="text-xs text-brand-500">â€»3ã¤ä»¥ä¸Šé¸æŠã§å……å®Ÿåº¦UP</span>
                </div>
                <div id="skills-container" class="space-y-3 relative z-10"></div>
                <div class="mt-4 relative z-10">
                    <label class="block text-sm font-medium text-brand-700 tracking-widest">è£œè¶³èª¬æ˜</label>
                    <textarea name="skillDescription" rows="3" maxlength="300" class="mt-1 block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-3 border bg-[#fffdf9] leading-relaxed"></textarea>
                </div>
            </div>

            <!-- 7. çµŒæ­´ -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <div class="flex justify-between items-center mb-6 border-b border-brand-200 pb-2 relative z-10">
                    <h2 class="text-lg font-bold text-brand-900 font-serif tracking-widest">â‘¦ çµŒæ­´</h2>
                    <button type="button" onclick="addCareerField()" class="text-sm font-bold text-brand-600 hover:text-brand-800 transition-colors border border-brand-300 px-3 py-1 rounded-sm bg-[#f7f5f0] shadow-sm"><i class="fa-solid fa-plus mr-1"></i>è¿½åŠ ã™ã‚‹</button>
                </div>
                <div id="career-list" class="space-y-6 relative z-10"></div>
            </div>

            <!-- 8 & 9. æƒ³ã„ãƒ»ç›®æ¨™ -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <h2 class="text-lg font-bold text-brand-900 mb-6 pb-2 border-b border-brand-200 font-serif tracking-widest">â‘§ æƒ³ã„ãƒ»â‘¨ ã‚„ã‚ŠãŸã„ã“ã¨</h2>
                <div class="space-y-8 relative z-10">
                    <div>
                        <div class="flex items-center mb-2">
                            <label class="block text-sm font-bold text-brand-800 tracking-widest">æƒ³ã„ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                            <span class="bg-brand-50 border border-brand-200 text-brand-600 text-[10px] font-bold px-2 py-0.5 rounded-sm ml-3 tracking-widest"><i class="fa-solid fa-handshake mr-1"></i>ç›¸äº’ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼é™å®š</span>
                        </div>
                        <textarea name="message" rows="6" class="block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-4 border bg-[#fffdf9] leading-relaxed"></textarea>
                        <p class="text-xs text-brand-500 mt-1 text-right">â€»500æ–‡å­—ä»¥ä¸Šã§å……å®Ÿåº¦UP</p>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-brand-800 tracking-widest mb-2">ä»Šå¾Œã‚„ã‚ŠãŸã„ã“ã¨ãƒ»ç›®æ¨™</label>
                        <textarea name="goals" rows="6" class="block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-4 border bg-[#fffdf9] leading-relaxed"></textarea>
                        <p class="text-xs text-brand-500 mt-1 text-right">â€»500æ–‡å­—ä»¥ä¸Šã§å……å®Ÿåº¦UP</p>
                    </div>
                </div>
            </div>

            <!-- 10. ãƒãƒƒãƒãƒ³ã‚° -->
            <div class="bg-[#fffdf9] shadow-md rounded-sm border border-brand-200 p-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-8 h-8 border-t border-r border-brand-500 z-10 m-2"></div>
                <h2 class="text-lg font-bold text-brand-900 mb-6 pb-2 border-b border-brand-200 font-serif tracking-widest">â‘© ãƒãƒƒãƒãƒ³ã‚°æƒ…å ±</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 relative z-10">
                    <div>
                        <label class="block text-sm font-bold text-brand-800 tracking-widest">æä¾›ã§ãã‚‹ã“ã¨</label>
                        <p class="text-xs text-brand-500 mb-2 mt-1">ã‚«ãƒ³ãƒ(,)åŒºåˆ‡ã‚Šã§å…¥åŠ›</p>
                        <textarea name="canOffer" rows="4" class="block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-3 border bg-[#f7f5f0] leading-relaxed"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-brand-800 tracking-widest">æ±‚ã‚ã¦ã„ã‚‹ã“ã¨</label>
                        <p class="text-xs text-brand-500 mb-2 mt-1">ã‚«ãƒ³ãƒ(,)åŒºåˆ‡ã‚Šã§å…¥åŠ›</p>
                        <textarea name="lookingFor" rows="4" class="block w-full border-brand-200 rounded-sm shadow-sm sm:text-sm p-3 border bg-[#eae5d8] leading-relaxed"></textarea>
                    </div>
                </div>
            </div>

        </form>
    </main>

    <!-- Notification -->
    <div id="notification" class="fixed top-20 left-1/2 transform -translate-x-1/2 z-50 hidden max-w-sm w-[90%] shadow-xl rounded-sm p-4 border-l-4 backdrop-blur-md bg-opacity-95 text-center">
        <p id="notif-message" class="text-sm font-bold tracking-widest font-serif"></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBVDZJhL9sMzVknD5tNomLWF-0z0jPU3i0",
            authDomain: "brainbridge-4b8ac.firebaseapp.com",
            projectId: "brainbridge-4b8ac",
            storageBucket: "brainbridge-4b8ac.firebasestorage.app",
            messagingSenderId: "803209683213",
            appId: "1:803209683213:web:b62d13784fa2bbbb9f5044"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const appId = 'default-app-id';

        let currentUser = null;
        let currentUserData = {};
        let targetUid = null;
        let isAdmin = false;

        const isAdminMock = localStorage.getItem('isAdminMock') === 'true';

        // Master Data
        const prefectures = ["åŒ—æµ·é“","é’æ£®çœŒ","å²©æ‰‹çœŒ","å®®åŸçœŒ","ç§‹ç”°çœŒ","å±±å½¢çœŒ","ç¦å³¶çœŒ","èŒ¨åŸçœŒ","æ ƒæœ¨çœŒ","ç¾¤é¦¬çœŒ","åŸ¼ç‰çœŒ","åƒè‘‰çœŒ","æ±äº¬éƒ½","ç¥å¥ˆå·çœŒ","æ–°æ½ŸçœŒ","å¯Œå±±çœŒ","çŸ³å·çœŒ","ç¦äº•çœŒ","å±±æ¢¨çœŒ","é•·é‡çœŒ","å²é˜œçœŒ","é™å²¡çœŒ","æ„›çŸ¥çœŒ","ä¸‰é‡çœŒ","æ»‹è³€çœŒ","äº¬éƒ½åºœ","å¤§é˜ªåºœ","å…µåº«çœŒ","å¥ˆè‰¯çœŒ","å’Œæ­Œå±±çœŒ","é³¥å–çœŒ","å³¶æ ¹çœŒ","å²¡å±±çœŒ","åºƒå³¶çœŒ","å±±å£çœŒ","å¾³å³¶çœŒ","é¦™å·çœŒ","æ„›åª›çœŒ","é«˜çŸ¥çœŒ","ç¦å²¡çœŒ","ä½è³€çœŒ","é•·å´çœŒ","ç†Šæœ¬çœŒ","å¤§åˆ†çœŒ","å®®å´çœŒ","é¹¿å…å³¶çœŒ","æ²–ç¸„çœŒ","æµ·å¤–","ãã®ä»–"];
        const hobbyCategories = {
            "ğŸƒ ã‚¹ãƒãƒ¼ãƒ„ãƒ»é‹å‹•ç³»": ["ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°", "ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°", "ç­‹ãƒˆãƒ¬", "ãƒ¨ã‚¬", "ãƒ”ãƒ©ãƒ†ã‚£ã‚¹", "ãƒ€ãƒ³ã‚¹", "ãƒã‚¹ã‚±ãƒƒãƒˆãƒœãƒ¼ãƒ«", "ã‚µãƒƒã‚«ãƒ¼", "ãƒ•ãƒƒãƒˆã‚µãƒ«", "é‡çƒ", "ãƒ†ãƒ‹ã‚¹", "ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³", "å“çƒ", "ã‚´ãƒ«ãƒ•", "ãƒœãƒ«ãƒ€ãƒªãƒ³ã‚°", "ç™»å±±", "ã‚µãƒ¼ãƒ•ã‚£ãƒ³", "ã‚¹ãƒãƒ¼ãƒœãƒ¼ãƒ‰", "ã‚¹ã‚­ãƒ¼", "ã‚µã‚¤ã‚¯ãƒªãƒ³ã‚°", "æ°´æ³³", "æ ¼é—˜æŠ€", "æ­¦é“"],
            "ğŸµ éŸ³æ¥½ãƒ»ã‚¨ãƒ³ã‚¿ãƒ¡": ["ã‚«ãƒ©ã‚ªã‚±", "æ¥½å™¨æ¼”å¥ï¼ˆã‚®ã‚¿ãƒ¼ï¼‰", "æ¥½å™¨æ¼”å¥ï¼ˆãƒ”ã‚¢ãƒï¼‰", "ä½œæ›²", "æ­Œ", "ãƒ©ã‚¤ãƒ–é‘‘è³", "ãƒ•ã‚§ã‚¹", "DJ", "æ˜ ç”»é‘‘è³", "ã‚¢ãƒ‹ãƒ¡é‘‘è³", "æ¼«ç”»", "ã‚²ãƒ¼ãƒ ", "ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ "],
            "ğŸ¨ æ–‡åŒ–ãƒ»ã‚¢ãƒ¼ãƒˆ": ["çµµç”»", "ã‚¤ãƒ©ã‚¹ãƒˆ", "ãƒ‡ã‚¶ã‚¤ãƒ³", "å†™çœŸæ’®å½±", "å‹•ç”»ç·¨é›†", "æ‰‹èŠ¸", "DIY", "å°èª¬åŸ·ç­†", "ãƒ–ãƒ­ã‚°"],
            "ğŸ“š å­¦ã³": ["èª­æ›¸", "è‡ªå·±å•“ç™º", "æ­´å²", "å¿ƒç†å­¦", "æŠ•è³‡", "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°", "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°", "è‹±èªå­¦ç¿’", "è³‡æ ¼å–å¾—"],
            "ğŸ³ é£Ÿãƒ»æš®ã‚‰ã—": ["æ–™ç†", "ãŠè“å­ä½œã‚Š", "ã‚«ãƒ•ã‚§å·¡ã‚Š", "é£Ÿã¹æ­©ã", "ãŠé…’", "ã‚³ãƒ¼ãƒ’ãƒ¼", "ã‚¤ãƒ³ãƒ†ãƒªã‚¢", "ãƒŸãƒ‹ãƒãƒªã‚ºãƒ "],
            "âœˆï¸ æ—…è¡Œ": ["å›½å†…æ—…è¡Œ", "æµ·å¤–æ—…è¡Œ", "ä¸€äººæ—…", "ã‚­ãƒ£ãƒ³ãƒ—", "æ¸©æ³‰å·¡ã‚Š", "ç¥ç¤¾ä»é–£å·¡ã‚Š"],
            "ğŸ¤ äºº": ["äº¤æµä¼š", "ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢", "åœ°åŸŸæ´»å‹•", "ã‚³ãƒ¼ãƒãƒ³ã‚°", "å­è‚²ã¦"],
            "ğŸŒ¿ ãã®ä»–": ["ç‘æƒ³", "å ã„", "ãã®ä»–"]
        };
        const skillCategories = {
            "ğŸ’» IT": ["Webåˆ¶ä½œ", "WordPress", "Firebase", "ãƒãƒ¼ã‚³ãƒ¼ãƒ‰", "ã‚¢ãƒ—ãƒªé–‹ç™º", "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°", "ãƒ‡ãƒ¼ã‚¿åˆ†æ", "AIæ´»ç”¨"],
            "ğŸ¤ ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³": ["ãƒ—ãƒ¬ã‚¼ãƒ³", "ãƒ•ã‚¡ã‚·ãƒªãƒ†ãƒ¼ã‚·ãƒ§ãƒ³", "è¬›å¸«", "ã‚³ãƒ¼ãƒãƒ³ã‚°", "å–¶æ¥­", "äº¤æ¸‰", "ã‚¤ãƒ³ã‚¿ãƒ“ãƒ¥ãƒ¼"],
            "âœï¸ ç™ºä¿¡": ["ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°", "SNSé‹ç”¨", "ãƒ–ãƒ­ã‚°é‹å–¶", "å‹•ç”»ç·¨é›†", "ãƒ‡ã‚¶ã‚¤ãƒ³"],
            "ğŸ’¼ ãƒ“ã‚¸ãƒã‚¹": ["èµ·æ¥­", "çµŒå–¶", "ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°", "ä¼šè¨ˆ", "äººäº‹", "è‹±èª"],
            "ğŸ§˜ ãã®ä»–": ["æ–™ç†æŒ‡å°", "æ•´ç†åç´", "å¥åº·ç®¡ç†"]
        };

        document.addEventListener('DOMContentLoaded', () => {
            initUI();
        });

        onAuthStateChanged(auth, async (user) => {
            if (isAdminMock) {
                currentUser = { uid: 'test_admin_uid' };
                isAdmin = true;
                targetUid = 'test_admin_uid';
                populateForm({userId:'admin', name:'ç®¡ç†è€…'});
                return;
            }

            if (user) {
                currentUser = user;
                
                // 1. ç®¡ç†è€…ãƒã‚§ãƒƒã‚¯
                try {
                    const myProfileRef = doc(db, 'artifacts', appId, 'users', user.uid, 'profile', 'data');
                    const myProfileSnap = await getDoc(myProfileRef);
                    if (myProfileSnap.exists() && myProfileSnap.data().userId === 'admin') {
                        isAdmin = true;
                        document.getElementById('admin-label').classList.remove('hidden');
                    }
                    if (user.uid === "Zm7FWRopJKVfyzbp8KXXokMFjNC3") { 
                        isAdmin = true;
                        document.getElementById('admin-label').classList.remove('hidden');
                    }
                } catch(e) { console.error("Admin Check Error", e); }

                // 2. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ±ºå®š
                const urlParams = new URLSearchParams(window.location.search);
                const paramUid = urlParams.get('uid');
                
                if (paramUid && paramUid !== user.uid) {
                    if (isAdmin) {
                        targetUid = paramUid;
                        showNotification('ç®¡ç†è€…æ¨©é™ã§ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç·¨é›†ã—ã¾ã™', 'info');
                    } else {
                        alert("æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“");
                        window.location.href = "user.html";
                        return;
                    }
                } else {
                    targetUid = user.uid;
                }

                await loadUserProfile(targetUid);
            } else {
                window.location.href = 'login.html';
            }
        });

        function initUI() {
            // éƒ½é“åºœçœŒã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®åˆæœŸåŒ–ï¼ˆã‚¨ãƒªã‚¢ç”¨ãƒ»å‡ºèº«åœ°ç”¨ï¼‰
            const areaSelect = document.getElementById('prefecture-select');
            const birthSelect = document.getElementById('birth-prefecture-select');
            
            prefectures.forEach(p => {
                const optArea = document.createElement('option');
                optArea.value = p; optArea.textContent = p;
                areaSelect.appendChild(optArea);
                
                const optBirth = document.createElement('option');
                optBirth.value = p; optBirth.textContent = p;
                if(birthSelect) birthSelect.appendChild(optBirth);
            });
            renderCategorySection('hobbies-container', hobbyCategories, 'hobbies');
            renderCategorySection('skills-container', skillCategories, 'skills');
        }

        function renderCategorySection(containerId, categoriesData, inputName) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            for (const [category, items] of Object.entries(categoriesData)) {
                const details = document.createElement('details');
                details.className = 'group border border-brand-200 rounded-sm bg-[#fffdf9] overflow-hidden mb-2';
                details.innerHTML = `<summary class="p-3 cursor-pointer hover:bg-brand-50 font-bold text-sm text-brand-800 flex justify-between tracking-widest">${category} <span class="accordion-arrow text-brand-400">â–¼</span></summary><div class="p-3 flex flex-wrap gap-2 border-t border-dashed border-brand-200 bg-brand-50"></div>`;
                const div = details.querySelector('div');
                items.forEach(item => {
                    div.innerHTML += `<label class="cursor-pointer"><input type="checkbox" name="${inputName}" value="${item}" class="tag-checkbox hidden"><div class="px-3 py-1.5 rounded-sm border border-brand-200 text-xs hover:bg-[#fffdf9] transition-colors tracking-widest text-brand-700 bg-white shadow-sm">${item}</div></label>`;
                });
                container.appendChild(details);
            }
        }

        async function loadUserProfile(uid) {
            try {
                const docRef = doc(db, 'artifacts', appId, 'users', uid, 'profile', 'data');
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    currentUserData = docSnap.data();
                } else {
                    currentUserData = { userId: uid };
                }
                populateForm(currentUserData);
            } catch (e) {
                console.error(e);
                showNotification("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ", 'error');
            }
        }

        function populateForm(data) {
            const form = document.getElementById('profile-form');
            if(!data) return;
            
            Array.from(form.elements).forEach(el => {
                if(el.name && data[el.name] !== undefined) {
                    if(el.type === 'checkbox' || el.type === 'radio' || el.type === 'file') return;
                    
                    // é…åˆ—ã®å ´åˆã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šæ–‡å­—åˆ—ã«
                    if (Array.isArray(data[el.name])) {
                        el.value = data[el.name].join(', ');
                    } else {
                        el.value = data[el.name];
                    }
                }
            });
            
            const hobbies = data.hobbies || [];
            const skills = data.skills || [];
            form.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                if(hobbies.includes(cb.value) || skills.includes(cb.value)) {
                    cb.checked = true;
                    cb.closest('details').open = true;
                }
            });

            if(data.photoURL) {
                document.getElementById('edit-icon-preview').src = data.photoURL;
                document.getElementById('edit-icon-preview').classList.remove('hidden');
                document.getElementById('edit-icon-placeholder').classList.add('hidden');
            }

            document.getElementById('career-list').innerHTML = '';
            if(data.career && data.career.length > 0) {
                data.career.forEach(c => addCareerField(c));
            }
        }

        window.addCareerField = (data = {}) => {
            const container = document.getElementById('career-list');
            const div = document.createElement('div');
            div.className = 'bg-[#f7f5f0] p-5 rounded-sm border border-brand-200 relative career-item shadow-sm';
            div.innerHTML = `
                <button type="button" onclick="this.parentElement.remove()" class="absolute top-2 right-3 text-brand-300 hover:text-red-800 transition-colors"><i class="fa-solid fa-trash"></i></button>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3 mt-2">
                    <input type="text" class="career-company w-full border-brand-200 rounded-sm p-2 text-sm bg-[#fffdf9]" placeholder="ä¼šç¤¾ãƒ»çµ„ç¹”å" value="${data.company||''}">
                    <input type="text" class="career-role w-full border-brand-200 rounded-sm p-2 text-sm bg-[#fffdf9]" placeholder="å½¹è·ãƒ»å½¹å‰²" value="${data.role||''}">
                </div>
                <div class="grid grid-cols-2 gap-4 mb-3">
                    <input type="month" class="career-start w-full border-brand-200 rounded-sm p-2 text-sm bg-[#fffdf9]" value="${data.start||''}">
                    <input type="month" class="career-end w-full border-brand-200 rounded-sm p-2 text-sm bg-[#fffdf9]" value="${data.end||''}">
                </div>
                <textarea class="career-desc w-full border-brand-200 rounded-sm p-3 text-sm bg-[#fffdf9] leading-relaxed" rows="3" placeholder="çµŒæ­´ã®è©³ç´°ãªèª¬æ˜">${data.description||''}</textarea>
            `;
            container.appendChild(div);
        };

        document.getElementById('icon-upload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const img = document.getElementById('edit-icon-preview');
                    img.src = ev.target.result;
                    img.classList.remove('hidden');
                    document.getElementById('edit-icon-placeholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        window.saveProfile = async () => {
            if (!currentUser) return;
            showNotification('è¨˜éŒ²ã‚’ä¿å­˜ä¸­...', 'info');

            const form = document.getElementById('profile-form');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            data.hobbies = Array.from(form.querySelectorAll('input[name="hobbies"]:checked')).map(cb => cb.value);
            data.skills = Array.from(form.querySelectorAll('input[name="skills"]:checked')).map(cb => cb.value);
            
            data.career = [];
            document.querySelectorAll('.career-item').forEach(item => {
                data.career.push({
                    company: item.querySelector('.career-company').value,
                    role: item.querySelector('.career-role').value,
                    start: item.querySelector('.career-start').value,
                    end: item.querySelector('.career-end').value,
                    description: item.querySelector('.career-desc').value
                });
            });
            
            if(data.canOffer) data.canOffer = data.canOffer.split(',').map(s=>s.trim()).filter(s=>s);
            if(data.lookingFor) data.lookingFor = data.lookingFor.split(',').map(s=>s.trim()).filter(s=>s);

            const iconFile = document.getElementById('icon-upload').files[0];
            let photoURL = currentUserData.photoURL || null;
            if (iconFile && !isAdminMock) {
                try {
                    const snap = await uploadBytes(ref(storage, `users/${targetUid}/profile_icon.jpg`), iconFile);
                    photoURL = await getDownloadURL(snap.ref);
                } catch(e) { console.error("Img upload err", e); }
            }
            data.photoURL = photoURL;
            
            // --- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å……å®Ÿåº¦ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ (12é …ç›®ãƒ»100%æº€ç‚¹) ---
            let scoreCount = 0;
            const maxScore = 12;

            if (data.jobTitle && data.jobTitle.trim() !== '') scoreCount++;
            if (data.name && data.nameKana && data.gender && data.birthDate) scoreCount++;
            if (data.bio && data.bio.trim().length >= 100) scoreCount++;
            if (data.contactEmail || data.websiteUrl || data.snsInstagram || data.snsX) scoreCount++;
            if (data.birthPrefecture && data.birthCity) scoreCount++;
            if (data.prefecture && data.city) scoreCount++;
            if (data.hobbies && data.hobbies.length >= 3) scoreCount++;
            if (data.skills && data.skills.length >= 3) scoreCount++;
            if (data.career && data.career.length >= 1) scoreCount++;
            if (data.message && data.message.trim().length >= 500) scoreCount++;
            if (data.goals && data.goals.trim().length >= 500) scoreCount++;
            if (data.canOffer && data.canOffer.length >= 1 && data.lookingFor && data.lookingFor.length >= 1) scoreCount++;

            data.profileScore = Math.floor((scoreCount / maxScore) * 100);
            data.updatedAt = new Date().toISOString();

            // --- ãƒ‡ãƒ¼ã‚¿ã®å¼•ãç¶™ã ---
            const finalData = { ...currentUserData, ...data };
            
            if (!finalData.userId) {
                finalData.userId = targetUid;
            }

            finalData.membershipRank = currentUserData.membershipRank || 'arrival'; // WALKERã‹ã‚‰ARRIVALã«å¤‰æ›´
            finalData.profilePublic = data.profilePublic;

            if (currentUser.uid === 'test_admin_uid') {
                showNotification(`ä¿å­˜ã—ã¾ã—ãŸ(ãƒ†ã‚¹ãƒˆ) å……å®Ÿåº¦: ${data.profileScore}%`, 'success');
                setTimeout(() => window.location.href = 'user.html', 1500);
                return;
            }

            try {
                // 1. Private Data
                const privateDocRef = doc(db, 'artifacts', appId, 'users', targetUid, 'profile', 'data');
                await setDoc(privateDocRef, finalData);

                // 2. Public Data
                const publicDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', targetUid);
                
                const isPaidMember = (finalData.membershipRank !== 'arrival');
                const isPublicSetting = (finalData.profilePublic === 'true');
                const canPublish = isPaidMember || isAdmin;

                if (isPublicSetting && canPublish) {
                    const publicData = {
                        ...finalData,
                        updatedAt: new Date().toISOString(),
                        isHidden: false
                    };
                    await setDoc(publicDocRef, publicData);
                } else {
                    // â˜…ä¿®æ­£ï¼šéå…¬é–‹ã®å ´åˆã§ã‚‚ã€ç´¹ä»‹è€…ãƒªã‚¹ãƒˆç­‰ã§å¿…è¦ãªæœ€ä½é™ã®æƒ…å ±ã¯æ®‹ã™
                    const minimalData = {
                        userId: finalData.userId,
                        name: finalData.name || finalData.userId,
                        photoURL: finalData.photoURL || null,
                        email: finalData.email || null, 
                        isHidden: true,
                        referrerId: finalData.referrerId || null,
                        profileScore: finalData.profileScore || 0
                    };
                    await setDoc(publicDocRef, minimalData);
                }

                if (isPublicSetting && !canPublish) {
                    alert(`ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚(å……å®Ÿåº¦: ${data.profileScore}%)\nâ€»ç¾åœ¨ARRIVALä¼šå“¡ã®ãŸã‚ã€è¨­å®šã‚’ã€Œå…¬é–‹ã€ã«ã—ã¦ã‚‚æ¤œç´¢çµæœã«ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚`);
                } else {
                    showNotification(`èˆªæµ·éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸ (å……å®Ÿåº¦: ${data.profileScore}%)`, 'success');
                }

                setTimeout(() => window.location.href = `user.html?uid=${targetUid}`, 1500);

            } catch (e) {
                console.error("Save error details:", e);
                let errorMsg = 'ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ';
                if (e.code === 'permission-denied') errorMsg += ': æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';
                else if (e.message.includes('undefined')) errorMsg += ': å¿…é ˆãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚';
                else errorMsg += `: ${e.message}`;
                showNotification(errorMsg, 'error');
            }
        };

        window.showNotification = (msg, type) => {
            const notif = document.getElementById('notification');
            const msgEl = document.getElementById('notif-message');
            notif.classList.remove('hidden', 'bg-[#f7f5f0]', 'bg-[#3e2723]', 'bg-[#8b6a4f]', 'text-[#4a3b32]', 'text-[#f7f5f0]', 'border-[#c8b9a6]', 'border-[#8b6a4f]', 'border-[#b8860b]');
            
            if(type === 'error') {
                notif.classList.add('bg-[#f7f5f0]', 'border-[#c8b9a6]', 'text-[#3e2723]');
            } else if (type === 'success') {
                notif.classList.add('bg-[#3e2723]', 'border-[#8b6a4f]', 'text-[#f7f5f0]');
            } else {
                notif.classList.add('bg-[#3e2723]', 'border-[#b8860b]', 'text-[#d4af37]');
            }
            
            msgEl.textContent = msg;
            notif.classList.remove('hidden');
            setTimeout(() => notif.classList.add('hidden'), 3500);
        };
    </script>
</body>
</html>
